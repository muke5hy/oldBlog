<!DOCTYPE html>
<html lang="en">
<head>
        <title>Updating data in query with forEach</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="http://www.mukeshyadav.com/theme/css/main.css" />
        <link href="http://www.mukeshyadav.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Learning the hard way! Full Atom Feed" />
        <link href="http://www.mukeshyadav.com/feeds/category/article.atom.xml" type="application/atom+xml" rel="alternate" title="Learning the hard way! Categories Atom Feed" />
</head>
<body>
    <script>
      if (window.location.href.indexOf('ingenioustechie.com') > 0) {
        window.location.href = window.location.href.replace('ingenioustechie.com', "mukeshyadav.com")
      }
    </script>

    <div class="main-nav-container">

        <div class="pure-g">
            <div class="pure-u-1 pure-u-lg-2-3">
                <div class="main-nav">
                    <ul class="main-nav-list">
                        <li class="main-nav-item"><a href="http://www.mukeshyadav.com/" class="pure-menu-link">Learning the hard way!</a></li>

                    </ul>
                </div>
             </div>

             <div class="pure-u-1 pure-u-lg-1-3"></div>
        </div>

    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
            <div class="pure-u-3-4 meta-data">
                <a href="http://www.mukeshyadav.com/category/article/index.html" class="category">article</a><br />

                <a class="author" href="http://www.mukeshyadav.com/author/mukesh.html">Mukesh</a>
                &mdash; <abbr title="2015-11-04T17:36:12+05:30">Wed 04 November 2015</abbr>
            </div>
        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>Updating data in query with forEach</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <div class="highlight"><pre>    Updating data in query with forEach
</pre></div>


<p>Since No-SQL does not have a structure or columns fixed when we store data into it, its very common or easy we insert unwanted keys into MongoDB. 
While developing some of the project I faced this issue as well. </p>
<p>To resolve such situation we can manually update each document, if the task is very small we might just write one update query and remove the key or replace the value. The problem with this is if there is conditional update we might have to write separate query and update it. </p>
<p>Since MongoDB uses V8 Javascript Engine we can use Javascript Language to write conditional queries. </p>
<div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">unit</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">unit</span><span class="p">.</span><span class="nx">expiry_date</span> <span class="o">&lt;=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">())</span>
        <span class="nx">unit</span><span class="p">.</span><span class="nx">expired</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">listings</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">unit</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>


<p>The above code is self explanatory. Bottom line is if we want to edit in forEach we should create complete document and save it. </p>
    </div>

    <footer>
        <div class="tags">
            <a href="http://www.mukeshyadav.com/tag/MongoDB/index.html">MongoDB</a>
        </div>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="http://www.mukeshyadav.com/author/mukesh.html">Mukesh</a></h3>
                        <p class="author-description">
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>

    <div class="entry-content">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'ingenioustechie';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

</div>


</body>
</html>